# @marianmeres/interpolate - LLM Context File

## Package Overview

name: @marianmeres/interpolate
version: 1.2.0
author: Marian Meres
license: MIT
repository: https://github.com/marianmeres/interpolate
npm: https://www.npmjs.com/package/@marianmeres/interpolate
jsr: https://jsr.io/@marianmeres/interpolate

## Description

A simple string interpolation helper function that implements Docker Compose-style variable substitution syntax. Replaces placeholder variables in strings with values from a provided context object.

## Primary Runtime

Deno-first package with npm distribution. Written in TypeScript.

## Installation

```sh
# Deno / JSR
deno add jsr:@marianmeres/interpolate

# npm
npm install @marianmeres/interpolate
```

## API

### Function Signature

```typescript
function interpolate(str: string, context: Record<string, string>): string
```

### Parameters

- `str`: The input string containing variable placeholders
- `context`: A Record<string, string> providing values for variable substitution

### Return Value

Returns the input string with all placeholders replaced according to the substitution rules.

## Supported Syntax

| Pattern | Description | Empty Handling |
|---------|-------------|----------------|
| $VAR | Unbraced substitution (UPPERCASE only, pattern: /[A-Z_][A-Z0-9_]*/) | Returns original $VAR if not found |
| ${VAR} | Braced substitution (any case) | Returns empty string if not found |
| ${VAR:-default} | Default if unset OR empty | Uses default for undefined or "" |
| ${VAR-default} | Default only if unset | Uses default only for undefined |
| ${VAR:?error} | Error if unset OR empty | Throws for undefined or "" |
| ${VAR?error} | Error only if unset | Throws only for undefined |
| ${VAR:!error} | Same as :? (alternative syntax) | Throws for undefined or "" |
| ${VAR!error} | Same as ? (alternative syntax) | Throws only for undefined |
| ${VAR:+replacement} | Replace if set AND non-empty | Returns replacement or "" |
| ${VAR+replacement} | Replace if set | Returns replacement or "" |

## Key Behaviors

1. UNBRACED VARIABLES: Only match UPPERCASE names (/[A-Z_][A-Z0-9_]*/). Unmatched unbraced vars return the original string (e.g., "$foo" stays "$foo").

2. BRACED VARIABLES: Match any case. Unmatched braced vars return empty string.

3. CONTEXT VALUES: Must be strings (Record<string, string>).

4. ERROR SYNTAX: Both "?" and "!" are supported for assertion operators.

5. NESTED NOTATION: Not supported. Inner placeholders are processed first, leading to unexpected results.

6. EMPTY VS UNSET:
   - Empty = "" (empty string)
   - Unset = undefined (key not present in context)

## File Structure

```
@marianmeres/interpolate/
├── src/
│   ├── mod.ts              # Entry point, re-exports interpolate.ts
│   └── interpolate.ts      # Main implementation (~115 lines)
├── tests/
│   └── interpolation.test.ts  # Comprehensive test suite (~220 lines)
├── scripts/
│   └── build-npm.ts        # Deno script for npm package build
├── deno.json               # Deno configuration
├── LICENSE                 # MIT License
├── README.md               # Documentation
├── .editorconfig           # Editor settings (tabs, UTF-8, LF)
└── .npm-dist/              # Generated npm package output
```

## Development Commands

```sh
# Run tests (watch mode)
deno task test

# Build npm package
deno task npm:build

# Build and publish to npm
deno task npm:publish
```

## Dependencies

Development only (from deno.json imports):
- @std/assert: Testing assertions
- @std/fs: File system operations (build script)
- @std/path: Path utilities (build script)

No runtime dependencies.

## Implementation Details

The core implementation uses a single regex replacement:
```typescript
/\$\{([^}]+)\}|\$([A-Z_][A-Z0-9_]*)/g
```

This matches:
1. Braced expressions: ${...}
2. Unbraced uppercase variables: $VAR

The replacement function parses the matched content to determine which operator is being used and applies the appropriate logic.

## Test Coverage

The test suite covers:
- Basic substitution (braced and unbraced)
- Default value operators (:- and -)
- Error/assertion operators (:?, ?, :!, !)
- Replacement operators (:+ and +)
- Case sensitivity rules
- Multiple placeholders in one string
- Edge cases (malformed syntax, special characters)
- Unicode and special regex characters in values

## Code Style

- Tabs for indentation
- Line width: 90 characters
- UTF-8 encoding
- LF line endings
- Final newline required
